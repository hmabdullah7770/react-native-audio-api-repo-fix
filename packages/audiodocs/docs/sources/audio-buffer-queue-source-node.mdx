---
sidebar_position: 5
---

import { Optional, Experimental, Overridden } from '@site/src/components/Badges';

# AudioBufferQueueSourceNode

:::caution
Mobile only.
:::

The `AudioBufferQueueSourceNode` is an [`AudioBufferBaseSourceNode`](/docs/sources/audio-buffer-base-source-node) which represents player that consists of many short buffers.

## Constructor

[`BaseAudioContext.createBufferQueueSource(options: AudioBufferBaseSourceNodeOptions)`](/docs/core/base-audio-context#createbufferqueuesource)

```jsx
interface AudioBufferBaseSourceNodeOptions {
  pitchCorrection: boolean // specifies if pitch correction algorithm has to be available
}
```

## Example

```tsx
import React, { useRef } from 'react';
import {
  AudioContext,
  AudioBufferQueueSourceNode,
} from 'react-native-audio-api';

function App() {
    const audioContextRef = useRef<AudioContext | null>(null);
    if (!audioContextRef.current) {
        audioContextRef.current = new AudioContext();
    }
    const audioBufferQueue = audioContextRef.current.createBufferQueueSource();
    const buffer1 = ...; // Load your audio buffer here
    const buffer2 = ...; // Load another audio buffer if needed
    audioBufferQueue.enqueueBuffer(buffer1, false);
    audioBufferQueue.enqueueBuffer(buffer2, true); // Last buffer should be marked as is
    audioBufferQueue.connect(audioContextRef.current.destination);
    audioBufferQueue.start(audioContextRef.current.currentTime);
}
```

## Properties

`AudioBufferQueueSourceNode` does not define any additional properties.
It inherits all properties from [`AudioBufferBaseSourceNode`](/docs/sources/audio-buffer-base-source-node#properties).

## Methods

It inherits all methods from [`AudioBufferBaseSourceNode`](/docs/sources/audio-buffer-base-source-node#methods).

### `enqueueBuffer`

Adds another buffer to queue. Returns `bufferId` that can be used to identify the buffer in `onEnded` event.

| Parameters | Type | Description |
| :---: | :---: | :---- |
| `buffer` | [`AudioBuffer`](/docs/sources/audio-buffer) | Buffer with next data. |

#### Returns `string`.

### `dequeueBuffer`

Removes a buffer from the queue. Note that `onEnded` event will not be fired for buffers that were removed.

| Parameters | Type | Description |
| :---: | :---: | :---- |
| `bufferId` | `string` | ID of the buffer to remove from the queue. It should be valid id provided by `enqueueBuffer` method. |

#### Returns `undefined`.

### `clearBuffers`

Removes all buffers from the queue. Note that `onEnded` event will not be fired for buffers that were removed.

#### Returns `undefined`.

## Events

### `onEnded` <Overridden />

Sets (or remove) callback that will be fired when queue source node has been stopped with payload `event.bufferId = undefined`
or when a specific buffer has ended with payload `event.bufferId = <bufferId>`.

You can remove callback by passing `null`.

```ts
audioBufferSourceNode.onEnded = (event) => { //setting callback
  if (event.bufferId === undefined) {
    console.log('queue source node has been stopped');
  } else {
    console.log(`buffer with id {event.bufferId} ended`);
  }
};
```
